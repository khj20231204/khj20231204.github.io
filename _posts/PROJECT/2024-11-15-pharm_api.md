---
layout: single
title: XMLíŒŒì¼ì„ JSONìœ¼ë¡œ íŒŒì‹±í•˜ê¸°
categories: PROJECT
tag: []
---

1. # ëŒ€ìš©ëŸ‰ api
   <a href="https://safemap.go.kr/opna/data/dataView.do?objtId=127">https://safemap.go.kr/opna/data/dataView.do?objtId=127</a>   
   ì „êµ­ ì•½êµ­ ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ëŠ”ë° ë°ì´í„° ê±´ ìˆ˜ê°€ 25ë§Œê°œ ì…ë‹ˆë‹¤.   

1. # pageNoì™€ numOfRows êµ¬ì„±
   http://safemap.go.kr/openApiService/data/getPharmacyData.do?serviceKey=AH80S7N7P3&pageNo=2&numOfRows=300&type=JSON   

   í•´ë‹¹ apiì˜ ì£¼ì†Œë¡œ pageNoì™€ numOfRowsë¥¼ ìš”ì²­í•©ë‹ˆë‹¤.   

   ì´ë•Œ í˜ì´ì§€ ê°’ê³¼ rowê°’ì€ ì–´ë–»ê²Œ ì„¤ì •í•˜ëŠëƒì— ë”°ë¼ ê°€ì ¸ì˜¤ëŠ” ê°’ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.   

   page=1, row=200 : 200


1. # itemìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°

   ```javascript
           
      let testUrl = encodeURI(`http://safemap.go.kr/openApiService/data/getPharmacyData.do?serviceKey=AH80S7N7P3&pageNo=2&numOfRows=300&type=JSON`);
      let response = await api.get(testUrl);

      console.log(response) 
      //ê²°ê³¼ ê°’ : {data: '<?xml version="1.0" encoding="UTF-8"?><response><hâ€¦totalCount>24474</totalCount>\n</body>\n</response>', status: 200, statusText: 'OK', headers: AxiosHeaders, config: {â€¦},Â â€¦}
   ```
   encodeURI :  ì£¼ì†Œì— ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ê³µë°±ì´ë‚˜ íŠ¹ìˆ˜ë¬¸ìë¥¼ urlí˜•íƒœë¡œ ë³€í˜•í•´ ì¤ë‹ˆë‹¤.   

   responseì˜ ê²°ê³¼ê°’ìœ¼ë¡œ data, status, statusText, headers, config ,... ë“±ì´ ìˆìŠµë‹ˆë‹¤.   
   ìš°ë¦¬ê°€ í•„ìš”í•œ ê²ƒì€ dataì™€ statusì…ë‹ˆë‹¤. statusë¥¼ í†µí•´ ifë¬¸ìœ¼ë¡œ ì •ìƒì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë°›ì•„ì™”ëŠ”ì§€, ì˜¤ë¥˜ê°€ ìˆì—ˆëŠ”ì§€ì˜ ì¡°ê±´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. statusê°€ 200ì´ë©´ ì •ìƒì…ë‹ˆë‹¤.   
   xmlí˜•ì‹ì´ë€ data ì „ì²´ë¥¼ ì–˜ê¸°í•©ë‹ˆë‹¤. xmlí˜•íƒœ ì „ì²´ `<?xml version="1.0" encoding="UTF-8"?>` ì´ ë¶€ë¶„ì´ í¬í•¨ëœ ì „ì²´ë¥¼ jsoní˜•íƒœë¡œ ë³€í˜• ì‹œì¼œì•¼ ì œëŒ€ë¡œ ì¸ì‹ì„ í•©ë‹ˆë‹¤.   

1. # xml -> jsion
   ```javascript

   ```


   1. ì„¸ë¶€ ë‚´ìš©ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°   

   ```javascript
      let testUrl = encodeURI(`http://safemap.go.kr/openApiService/data/getPharmacyData.do?serviceKey=AH80S7N7-AH80-AH80-AH80-AH80S7N7P3&pageNo=1&numOfRows=40&type=JSON`);
      let response = await api.get(testUrl.toString());
   ```
   data -> request -> responseXML -> all   

   <img src="../../imgs/project/pharm_api_1.png" style="border:3px solid black;border-radius:9px;width:600px">   
   6:item ~ 37:DUTYWEEKENDAT ê¹Œì§€ê°€ í•˜ë‚˜ì˜ ì•½êµ­ ì •ë³´ì…ë‹ˆë‹¤. 
   ê·¸ë¦¬ê³    
   38:item ~ 69:DUTYWEEKENDAT ê¹Œì§€ê°€ ë˜ í•˜ë‚˜ì˜ ì•½êµ­ ì •ë³´ì…ë‹ˆë‹¤.   

   6~37, 38~69, 70~101, ... 31ê°œ ë°ì´í„° ë‹¨ìœ„ë¡œ ë‹¤ìŒ ì•½êµ­ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. 

   ì´ rowê°’ì€ 8110ë²ˆê¹Œì§€ë¡œ 25,9529ê°œì˜ rowê°’ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.   

   ì „ì²´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ë„ˆë¬´ ë§ì€ delayê°€ ë°œìƒí•´ì„œ ì–´ë–»ê²Œ í• ê¹Œ ìƒê° ì¤‘ xmlíŒŒì¼ì„ dbì— ë„£ëŠ” ê²ƒì„ gptê°€ ì•Œë ¤ì£¼ì—ˆìŠµë‹ˆë‹¤.ğŸ‘Œ   

   1. pageì™€ row   
   pageê°€ 1ì´ë©´


1. # xml2js ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©

   xmlíŒŒì¼ì˜ ê°’ì„ ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•´ì„œëŠ” jsonìœ¼ë¡œ ë³€ê²½ì„ í•´ì•¼í•©ë‹ˆë‹¤.   

   xml2js ì„¤ì¹˜   
   ```javascript
      npm install axios xml2js
   ```   

   xml2js ì‚¬ìš©   
   ```javascript

      const xml2js = require('xml2js');
      //importê°€ ì•„ë‹ˆë¼ requireë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“±ë¡

      let testUrl = encodeURI(`http://safemap.go.kr/openApiService/data/getPharmacyData.do?serviceKey=AH80S7N7-AH80-AH80-AH80-AH80S7N7P3&pageNo=1&numOfRows=8110&type=JSON`);
      let response = await api.get(testUrl.toString());
      const xmlData = response.request.responseXML.all[5].innerHTML;
      
      //explicitArray ì˜µì…˜ì€ XML ìš”ì†Œê°€ ë°°ì—´ë¡œ ë³€í™˜ë ì§€ ì—¬ë¶€ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ê¸°ë³¸ê°’ì€ true
      const parse = new xml2js.Parser({explicitArray: false});
      const jsonData = await parse.parseStringPromise(xmlData);

      console.log(jsonData.item.DUTYADDR); //ëŒ€ì „ê´‘ì—­ì‹œ ë™êµ¬ ê³„ì¡±ë¡œ 362, ì„±ë‚¨ì•½êµ­ 1ì¸µ (ì„±ë‚¨ë™)
      console.log(jsonData.item.DUTYNAME); //ì„±ë‚¨ì•½êµ­
   ```
